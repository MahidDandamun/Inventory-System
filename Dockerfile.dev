# ============================================================
# Development image
# Source code is mounted as a volume — do NOT use this for prod.
# ============================================================
FROM node:22-alpine AS dev

# libc6-compat is needed for some native Node modules on Alpine
RUN apk add --no-cache libc6-compat

WORKDIR /app

# Install dependencies first (cache layer — only re-runs if lock file changes)
COPY package.json package-lock.json ./
COPY prisma ./prisma

# Install ALL dependencies including devDependencies
RUN npm ci

# Generate the Prisma Client
RUN npx prisma generate

# Copy source code.
# In development this layer is typically overridden by a bind mount
# (see docker-compose.dev.yml), so changes are reflected immediately
# without rebuilding the image.
COPY . .

ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1

# Next.js dev server port
EXPOSE 3000

# Prisma Studio port (optional — expose if you use it locally)
EXPOSE 5555

ENV HOSTNAME="0.0.0.0"
ENV PORT=3000

# Start the Next.js dev server with hot reloading
CMD ["npm", "run", "dev"]
